version: '3.8'

services:
  # 데이터베이스 컨테이너 설정
  db:
    image: mariadb:10.6 # MariaDB 10.6 버전 사용
    container_name: nestjs_mariadb_db
    restart: always
    environment:
      # 루트 비밀번호 (관리용)
      MYSQL_ROOT_PASSWORD: your_root_admin_password_2025 # 루트 비밀번호는 다르게 설정하세요.

      # NestJS 애플리케이션에서 사용할 사용자 계정 및 DB 이름
      MYSQL_USER: nestjs_user # DB_USERNAME 반영
      MYSQL_PASSWORD: nest_password_2025 # DB_PASSWORD 반영
      MYSQL_DATABASE: underphase # DB_NAME 반영

      # Timezone 설정 (선택 사항)
      TZ: Asia/Seoul

    # 호스트 포트 3308로 외부 접속 가능하도록 설정
    ports:
      - '3308:3306' # 호스트 포트 (DB_PORT): 컨테이너 내부 MariaDB 기본 포트

    # 데이터 영속성을 위한 볼륨 설정
    volumes:
      - mariadb_data:/var/lib/mysql

volumes:
  mariadb_data:
